package com.martinia.indigo.metadata.infrastructure.adapters.goodreads;

import com.martinia.indigo.BaseIndigoIntegrationTest;
import com.martinia.indigo.BaseIndigoTest;
import com.martinia.indigo.metadata.domain.ports.adapters.goodreads.FindGoodReadsAuthorPort;
import com.martinia.indigo.metadata.domain.ports.usecases.goodreads.FindGoodReadsAuthorUseCase;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.mock.mockito.MockBean;

import javax.annotation.Resource;

import static org.junit.jupiter.api.Assertions.assertArrayEquals;
import static org.junit.jupiter.api.Assertions.assertNull;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.Mockito.when;

class FindGoodReadsAuthorAdapterIntegrationTest extends BaseIndigoIntegrationTest {

	@Resource
	private FindGoodReadsAuthorPort findGoodReadsAuthorPort;

	private final String XML = "<GoodreadsResponse><Request><authentication>true</authentication><key><![CDATA[ usnvwo0d4PBtqDygTvVUcQ ]]></key><method><![CDATA[ search_search ]]></method></Request><search><query><![CDATA[ Eva Acosta ]]></query><results-start>1</results-start><results-end>10</results-end><total-results>93</total-results><source>Goodreads</source><query-time-seconds>0.06</query-time-seconds><results><work><id type=\"integer\">10202291</id><books_count type=\"integer\">1</books_count><ratings_count type=\"integer\">11</ratings_count><text_reviews_count type=\"integer\">1</text_reviews_count><original_publication_year type=\"integer\">2007</original_publication_year><original_publication_month type=\"integer\" nil=\"true\"/><original_publication_day type=\"integer\" nil=\"true\"/><average_rating>4.55</average_rating><best_book type=\"Book\"><id type=\"integer\">7648787</id><title>Emilia Pardo Bazán: La luz en la batalla. Biografía</title><author><id type=\"integer\">3859808</id><name>Eva Acosta</name></author><image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1466681732l/7648787._SX98_.jpg</image_url><small_image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1466681732l/7648787._SX50_.jpg</small_image_url></best_book></work><work><id type=\"integer\">94495113</id><books_count type=\"integer\">1</books_count><ratings_count type=\"integer\">2</ratings_count><text_reviews_count type=\"integer\">0</text_reviews_count><original_publication_year type=\"integer\" nil=\"true\"/><original_publication_month type=\"integer\" nil=\"true\"/><original_publication_day type=\"integer\" nil=\"true\"/><average_rating>5.00</average_rating><best_book type=\"Book\"><id type=\"integer\">59967460</id><title>Emilia Pardo Bazán: La luz en la batalla</title><author><id type=\"integer\">3859808</id><name>Eva Acosta</name></author><image_url>https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png</image_url><small_image_url>https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png</small_image_url></best_book></work><work><id type=\"integer\">183265441</id><books_count type=\"integer\">1</books_count><ratings_count type=\"integer\">0</ratings_count><text_reviews_count type=\"integer\">0</text_reviews_count><original_publication_year type=\"integer\" nil=\"true\"/><original_publication_month type=\"integer\" nil=\"true\"/><original_publication_day type=\"integer\" nil=\"true\"/><average_rating type=\"float\">0.0</average_rating><best_book type=\"Book\"><id type=\"integer\">177004487</id><title>Matemáticas bilingües, 1 ESO (Spanish Edition)</title><author><id type=\"integer\">40050485</id><name>Eva Acosta Gavlán</name></author><image_url>https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png</image_url><small_image_url>https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png</small_image_url></best_book></work><work><id type=\"integer\">137152982</id><books_count type=\"integer\">1</books_count><ratings_count type=\"integer\">0</ratings_count><text_reviews_count type=\"integer\">0</text_reviews_count><original_publication_year type=\"integer\" nil=\"true\"/><original_publication_month type=\"integer\" nil=\"true\"/><original_publication_day type=\"integer\" nil=\"true\"/><average_rating type=\"float\">0.0</average_rating><best_book type=\"Book\"><id type=\"integer\">114829989</id><title>Matemáticas Bilingües 2º ESO</title><author><id type=\"integer\">28665628</id><name>Eva María Acosta Gavilán</name></author><image_url>https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png</image_url><small_image_url>https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png</small_image_url></best_book></work><work><id type=\"integer\">184002902</id><books_count type=\"integer\">1</books_count><ratings_count type=\"integer\">0</ratings_count><text_reviews_count type=\"integer\">0</text_reviews_count><original_publication_year type=\"integer\" nil=\"true\"/><original_publication_month type=\"integer\" nil=\"true\"/><original_publication_day type=\"integer\" nil=\"true\"/><average_rating type=\"float\">0.0</average_rating><best_book type=\"Book\"><id type=\"integer\">178436441</id><title>¿Cómo mejorar la pronunciación del inglés en Educa-ción Infantil? (Spanish Edition)</title><author><id type=\"integer\">40207723</id><name>EVA MARÍA ACOSTA GARCÍA</name></author><image_url>https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png</image_url><small_image_url>https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png</small_image_url></best_book></work><work><id type=\"integer\">122131945</id><books_count type=\"integer\">1</books_count><ratings_count type=\"integer\">0</ratings_count><text_reviews_count type=\"integer\">0</text_reviews_count><original_publication_year type=\"integer\" nil=\"true\"/><original_publication_month type=\"integer\" nil=\"true\"/><original_publication_day type=\"integer\" nil=\"true\"/><average_rating type=\"float\">0.0</average_rating><best_book type=\"Book\"><id type=\"integer\">98369131</id><title>Matemáticas bilingües, 2 ESO</title><author><id type=\"integer\">26578910</id><name>Eva Acosta Gavilán</name></author><image_url>https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png</image_url><small_image_url>https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png</small_image_url></best_book></work><work><id type=\"integer\">1492357</id><books_count type=\"integer\">6</books_count><ratings_count type=\"integer\">4042</ratings_count><text_reviews_count type=\"integer\">128</text_reviews_count><original_publication_year type=\"integer\">2003</original_publication_year><original_publication_month type=\"integer\">9</original_publication_month><original_publication_day type=\"integer\">24</original_publication_day><average_rating>4.31</average_rating><best_book type=\"Book\"><id type=\"integer\">13272657</id><title>La boda del guerrero</title><author><id type=\"integer\">28375</id><name>Janet Chapman</name></author><image_url>https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png</image_url><small_image_url>https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png</small_image_url></best_book></work><work><id type=\"integer\">70644732</id><books_count type=\"integer\">1</books_count><ratings_count type=\"integer\">22</ratings_count><text_reviews_count type=\"integer\">2</text_reviews_count><original_publication_year type=\"integer\">2019</original_publication_year><original_publication_month type=\"integer\">2</original_publication_month><original_publication_day type=\"integer\">14</original_publication_day><average_rating>4.23</average_rating><best_book type=\"Book\"><id type=\"integer\">45837152</id><title>Antología de relatos románticos. San Valentín 2019</title><author><id type=\"integer\">2864099</id><name>Ana Álvarez</name></author><image_url>https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png</image_url><small_image_url>https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png</small_image_url></best_book></work><work><id type=\"integer\">1963079</id><books_count type=\"integer\">47</books_count><ratings_count type=\"integer\">3812</ratings_count><text_reviews_count type=\"integer\">233</text_reviews_count><original_publication_year type=\"integer\">2007</original_publication_year><original_publication_month type=\"integer\" nil=\"true\"/><original_publication_day type=\"integer\" nil=\"true\"/><average_rating>3.99</average_rating><best_book type=\"Book\"><id type=\"integer\">11556197</id><title>Mensaje De Muerte (Tom Thorne, #7)</title><author><id type=\"integer\">142411</id><name>Mark Billingham</name></author><image_url>https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png</image_url><small_image_url>https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png</small_image_url></best_book></work><work><id type=\"integer\">97655</id><books_count type=\"integer\">13</books_count><ratings_count type=\"integer\">436</ratings_count><text_reviews_count type=\"integer\">30</text_reviews_count><original_publication_year type=\"integer\">1993</original_publication_year><original_publication_month type=\"integer\">5</original_publication_month><original_publication_day type=\"integer\">1</original_publication_day><average_rating>4.14</average_rating><best_book type=\"Book\"><id type=\"integer\">12665746</id><title>Amante y canalla</title><author><id type=\"integer\">39691</id><name>Jo Goodman</name></author><image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1340549022l/12665746._SX98_.jpg</image_url><small_image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1340549022l/12665746._SY75_.jpg</small_image_url></best_book></work></results></search></GoodreadsResponse>";

	@Test
	public void testFindAuthor() {
		// Given
		String key = "example_key";
		String subject = "eva acosta";

		when(dataUtils.getData(anyString())).thenReturn(XML);

		// When
		String[] result = findGoodReadsAuthorPort.findAuthor(key, subject);

		// Then
		assertNull(result);
	}

}